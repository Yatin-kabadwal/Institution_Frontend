<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institution Registration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 40px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input.phone-valid {
            border-color: #10B981 !important;
            background-color: #f0fdf4;
        }

        input.phone-invalid {
            border-color: #EF4444 !important;
            background-color: #fef2f2;
        }

        select {
            cursor: pointer;
            background-color: white;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .step:first-child::before {
            display: none;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            z-index: 1;
            margin-bottom: 5px;
        }

        .step.active .step-number {
            background: #667eea;
            color: white;
        }

        .step.completed .step-number {
            background: #10B981;
            color: white;
        }

        .step-label {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #86efac;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .phone-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .phone-hint.valid {
            color: #10B981;
        }

        .phone-hint.invalid {
            color: #EF4444;
        }

        .hidden {
            display: none;
        }

        .otp-container {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .otp-input {
            text-align: center;
            font-size: 24px;
            letter-spacing: 10px;
            font-weight: bold;
        }

        .resend-link {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
        }

        .resend-link:hover {
            color: #764ba2;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 14px;
            color: #1e40af;
        }

        .institution-code-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.1);
        }

        .code-header h3 {
            color: #92400e;
            margin-bottom: 5px;
            font-size: 18px;
        }

        .code-header p {
            color: #78350f;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .code-display {
            background: white;
            border: 2px dashed #f59e0b;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .code-value {
            font-size: 24px;
            font-weight: bold;
            color: #92400e;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
        }

        .copy-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #10B981;
        }

        .code-warning {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
            padding: 10px;
            font-size: 13px;
            color: #92400e;
        }

        .code-warning strong {
            color: #dc2626;
        }

        #otherTypeContainer {
            margin-top: 15px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Institution Registration</h1>
            <p>Register your institution in 3 easy steps</p>
        </div>

        <div class="form-container">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1-indicator">
                    <div class="step-number">1</div>
                    <div class="step-label">Details</div>
                </div>
                <div class="step" id="step2-indicator">
                    <div class="step-number">2</div>
                    <div class="step-label">Verify OTP</div>
                </div>
                <div class="step" id="step3-indicator">
                    <div class="step-number">3</div>
                    <div class="step-label">Set Password</div>
                </div>
            </div>

            <!-- Messages -->
            <div id="errorMessage" class="error-message hidden"></div>
            <div id="successMessage" class="success-message hidden"></div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>

            <!-- Step 1: Registration Form -->
            <form id="registrationForm">
                <div class="info-box">
                    <strong>üìç Location:</strong> Currently serving Uttarakhand & Uttar Pradesh
                </div>

                <div class="form-group">
                    <label>Institution Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="Enter institution name">
                </div>

                <div class="form-group">
                    <label>Institution Type <span class="required">*</span></label>
                    <select id="type" name="type" required>
                        <option value="">Select Type</option>
                        <option value="School">School</option>
                        <option value="College">College</option>
                        <option value="University">University</option>
                        <option value="Other">Other (Specify)</option>
                    </select>
                    
                    <!-- Other Type Input (Hidden by default) -->
                    <div id="otherTypeContainer" class="hidden">
                        <input type="text" id="otherType" name="otherType" 
                               placeholder="Specify institution type (e.g., Training Center, Institute)" 
                               style="margin-top: 10px;">
                    </div>
                </div>

                <div class="form-group">
                    <label>State <span class="required">*</span></label>
                    <select id="state" name="state" required>
                        <option value="">Select State</option>
                        <option value="Uttarakhand">Uttarakhand</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>District <span class="required">*</span></label>
                    <select id="district" name="district" required disabled>
                        <option value="">First select a state</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>City/Town</label>
                    <input type="text" id="city" name="city" placeholder="Enter city or town">
                </div>

                <div class="form-group">
                    <label>Location/Address</label>
                    <input type="text" id="location" name="location" placeholder="Enter specific location">
                </div>

                <div class="form-group">
                    <label>Email Address <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="institution@example.com">
                </div>

                <div class="form-group">
                    <label>Primary Mobile Number <span class="required">*</span></label>
                    <input type="tel" id="mobile1" name="mobile1" required 
                           placeholder="Enter 10 digit mobile number" maxlength="10">
                    <div class="phone-hint" id="mobile1-hint">Enter 10 digits</div>
                </div>

                <div class="form-group">
                    <label>Secondary Mobile Number (Optional)</label>
                    <input type="tel" id="mobile2" name="mobile2" 
                           placeholder="Enter 10 digit mobile number" maxlength="10">
                    <div class="phone-hint" id="mobile2-hint">Enter 10 digits</div>
                </div>

                <button type="submit" class="btn" id="registerBtn">Register Institution</button>
            </form>

            <!-- Step 2: OTP Verification (Hidden by default) -->
            <div id="otpForm" class="hidden">
                <div class="otp-container">
                    <h3 style="margin-bottom: 15px; color: #333;">Enter Verification Code</h3>
                    <p style="color: #666; margin-bottom: 20px;">
                        We've sent a 6-digit OTP to <strong id="otpEmail"></strong>
                    </p>
                    
                    <div class="form-group">
                        <label>OTP Code <span class="required">*</span></label>
                        <input type="text" id="otp" name="otp" class="otp-input" 
                               required maxlength="6" placeholder="000000">
                    </div>

                    <button type="button" class="btn" id="verifyOtpBtn">Verify OTP</button>
                    <div style="text-align: center; margin-top: 15px;">
                        <span class="resend-link" id="resendOtpBtn">Didn't receive? Resend OTP</span>
                    </div>
                </div>
            </div>

            <!-- Step 3: Set Password (Hidden by default) -->
            <div id="passwordForm" class="hidden">
                <!-- Institution Code Display -->
                <div class="institution-code-box">
                    <div class="code-header">
                        <h3>üìã Your Institution Code</h3>
                        <p>Save this code - you'll need it for login</p>
                    </div>
                    <div class="code-display">
                        <span class="code-value" id="displayInstitutionCode"></span>
                        <button type="button" class="copy-btn" id="copyCodeBtn" title="Copy to clipboard">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="code-warning">
                        ‚ö†Ô∏è <strong>Important:</strong> Write this code down or save it securely. You'll need it to login.
                    </div>
                </div>

                <div class="form-group">
                    <label>Create Password <span class="required">*</span></label>
                    <input type="password" id="password" name="password" 
                           required placeholder="Minimum 8 characters">
                </div>

                <div class="form-group">
                    <label>Confirm Password <span class="required">*</span></label>
                    <input type="password" id="confirmPassword" name="confirmPassword" 
                           required placeholder="Re-enter password">
                </div>

                <button type="button" class="btn" id="setPasswordBtn">Set Password & Complete</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://institution-backend-kkw8.onrender.com/api';

        // State-District Mapping
        const stateDistrictMap = {
            'Uttarakhand': [
                'Almora', 'Bageshwar', 'Chamoli', 'Champawat', 'Dehradun',
                'Haridwar', 'Nainital', 'Pauri Garhwal', 'Pithoragarh',
                'Rudraprayag', 'Tehri Garhwal', 'Udham Singh Nagar', 'Uttarkashi'
            ],
            'Uttar Pradesh': [
                'Agra', 'Aligarh', 'Allahabad', 'Ambedkar Nagar', 'Amethi',
                'Amroha', 'Auraiya', 'Ayodhya', 'Azamgarh', 'Baghpat',
                'Bahraich', 'Ballia', 'Balrampur', 'Banda', 'Barabanki',
                'Bareilly', 'Basti', 'Bhadohi', 'Bijnor', 'Budaun',
                'Bulandshahr', 'Chandauli', 'Chitrakoot', 'Deoria', 'Etah',
                'Etawah', 'Farrukhabad', 'Fatehpur', 'Firozabad', 'Gautam Buddha Nagar',
                'Ghaziabad', 'Ghazipur', 'Gonda', 'Gorakhpur', 'Hamirpur',
                'Hapur', 'Hardoi', 'Hathras', 'Jalaun', 'Jaunpur',
                'Jhansi', 'Kannauj', 'Kanpur Dehat', 'Kanpur Nagar', 'Kasganj',
                'Kaushambi', 'Kushinagar', 'Lakhimpur Kheri', 'Lalitpur', 'Lucknow',
                'Maharajganj', 'Mahoba', 'Mainpuri', 'Mathura', 'Mau',
                'Meerut', 'Mirzapur', 'Moradabad', 'Muzaffarnagar', 'Pilibhit',
                'Pratapgarh', 'Prayagraj', 'Raebareli', 'Rampur', 'Saharanpur',
                'Sambhal', 'Sant Kabir Nagar', 'Shahjahanpur', 'Shamli', 'Shravasti',
                'Siddharthnagar', 'Sitapur', 'Sonbhadra', 'Sultanpur', 'Unnao', 'Varanasi'
            ]
        };

        // Global variable to store institution code
        let institutionCode = '';

        // DOM Elements
        const registrationForm = document.getElementById('registrationForm');
        const otpFormDiv = document.getElementById('otpForm');
        const passwordFormDiv = document.getElementById('passwordForm');
        const stateSelect = document.getElementById('state');
        const districtSelect = document.getElementById('district');
        const typeSelect = document.getElementById('type');
        const otherTypeContainer = document.getElementById('otherTypeContainer');
        const otherTypeInput = document.getElementById('otherType');
        const mobile1Input = document.getElementById('mobile1');
        const mobile2Input = document.getElementById('mobile2');
        const mobile1Hint = document.getElementById('mobile1-hint');
        const mobile2Hint = document.getElementById('mobile2-hint');

        // Institution Type Change Handler
        typeSelect.addEventListener('change', function() {
            if (this.value === 'Other') {
                otherTypeContainer.classList.remove('hidden');
                otherTypeInput.required = true;
            } else {
                otherTypeContainer.classList.add('hidden');
                otherTypeInput.required = false;
                otherTypeInput.value = '';
            }
        });

        // State Change Handler
        stateSelect.addEventListener('change', function() {
            const selectedState = this.value;
            districtSelect.innerHTML = '<option value="">Select District</option>';
            
            if (selectedState && stateDistrictMap[selectedState]) {
                districtSelect.disabled = false;
                stateDistrictMap[selectedState].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
                districtSelect.innerHTML = '<option value="">First select a state</option>';
            }
        });

        // Phone Validation Function
        function validatePhone(input, hintElement) {
            const value = input.value.replace(/\D/g, '');
            input.value = value;

            if (value.length === 10) {
                input.classList.remove('phone-invalid');
                input.classList.add('phone-valid');
                hintElement.textContent = '‚úì Valid 10 digit number';
                hintElement.classList.remove('invalid');
                hintElement.classList.add('valid');
                return true;
            } else if (value.length > 0) {
                input.classList.remove('phone-valid');
                input.classList.add('phone-invalid');
                hintElement.textContent = `‚úó ${value.length}/10 digits`;
                hintElement.classList.remove('valid');
                hintElement.classList.add('invalid');
                return false;
            } else {
                input.classList.remove('phone-valid', 'phone-invalid');
                hintElement.textContent = 'Enter 10 digits';
                hintElement.classList.remove('valid', 'invalid');
                return false;
            }
        }

        // Phone Input Listeners
        mobile1Input.addEventListener('input', function() {
            validatePhone(this, mobile1Hint);
        });

        mobile2Input.addEventListener('input', function() {
            validatePhone(this, mobile2Hint);
        });

        // Utility Functions
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
            setTimeout(() => successDiv.classList.add('hidden'), 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function updateStep(step) {
            for (let i = 1; i <= 3; i++) {
                const stepIndicator = document.getElementById(`step${i}-indicator`);
                stepIndicator.classList.remove('active', 'completed');
                
                if (i < step) {
                    stepIndicator.classList.add('completed');
                } else if (i === step) {
                    stepIndicator.classList.add('active');
                }
            }

            registrationForm.classList.toggle('hidden', step !== 1);
            otpFormDiv.classList.toggle('hidden', step !== 2);
            passwordFormDiv.classList.toggle('hidden', step !== 3);
        }

registrationForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Validate mobile numbers
    const mobile1Valid = validatePhone(mobile1Input, mobile1Hint);
    if (!mobile1Valid) {
        showError('Please enter a valid 10-digit primary mobile number');
        return;
    }

    const mobile2 = mobile2Input.value.trim();
    if (mobile2 && mobile2.length !== 10) {
        showError('Secondary mobile number must be 10 digits');
        return;
    }

    // Get institution type and custom type
    const selectedType = typeSelect.value;
    let institutionType = selectedType;
    let customType = '';

    // If "Other" is selected, validate and use custom type
    if (selectedType === 'Other') {
        const otherTypeValue = otherTypeInput.value.trim();
        if (!otherTypeValue) {
            showError('Please specify the institution type');
            otherTypeInput.focus();
            return;
        }
        institutionType = 'Other';
        customType = otherTypeValue;
    }

    showLoading(true);

    // Prepare form data with BOTH type and customType fields
    const formData = {
        name: document.getElementById('name').value.trim(),
        type: institutionType,  // Either 'School', 'College', 'University', or 'Other'
        customType: customType, // Empty string if not "Other", otherwise the custom value
        address: JSON.stringify({
            state: document.getElementById('state').value,
            district: document.getElementById('district').value,
            city: document.getElementById('city').value.trim() || '',
            location: document.getElementById('location').value.trim() || ''
        }),
        contacts: JSON.stringify({
            email: document.getElementById('email').value.trim(),
            mobile1: mobile1Input.value,
            mobile2: mobile2 || ''
        })
    };

    console.log('Sending registration data:', formData); // For debugging

    try {
        const response = await fetch(`${API_BASE_URL}/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            institutionCode = data.institutionCode;
            document.getElementById('otpEmail').textContent = document.getElementById('email').value;
            showSuccess(data.message);
            updateStep(2);
        } else {
            showError(data.message || 'Registration failed');
        }
    } catch (error) {
        showError('Network error. Please try again.');
        console.error('Registration error:', error);
    } finally {
        showLoading(false);
    }
});



// Step 2: Verify OTP (THIS IS MISSING!)
document.getElementById('verifyOtpBtn').addEventListener('click', async () => {
    const otp = document.getElementById('otp').value.trim();

    if (!otp || otp.length !== 6) {
        showError('Please enter a valid 6-digit OTP');
        return;
    }

    showLoading(true);

    try {
        const response = await fetch(`${API_BASE_URL}/auth/verify-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ institutionCode, otp })
        });

        const data = await response.json();

        if (data.success) {
            showSuccess(data.message);
            document.getElementById('displayInstitutionCode').textContent = institutionCode;
            updateStep(3);
        } else {
            showError(data.message || 'Invalid OTP');
        }
    } catch (error) {
        showError('Network error. Please try again.');
        console.error('OTP verification error:', error);
    } finally {
        showLoading(false);
    }
});

        // Resend OTP
        document.getElementById('resendOtpBtn').addEventListener('click', async () => {
            showLoading(true);

            try {
                const response = await fetch(`${API_BASE_URL}/auth/resend-otp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ institutionCode })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('OTP resent successfully!');
                } else {
                    showError(data.message || 'Failed to resend OTP');
                }
            } catch (error) {
                showError('Network error. Please try again.');
            } finally {
                showLoading(false);
            }
        });

        // Step 3: Set Password
        document.getElementById('setPasswordBtn').addEventListener('click', async () => {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password.length < 8) {
                showError('Password must be at least 8 characters');
                return;
            }

            if (password !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`${API_BASE_URL}/auth/set-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ institutionCode, password, confirmPassword })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Registration complete! Redirecting to login...');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showError(data.message || 'Failed to set password');
                }
            } catch (error) {
                showError('Network error. Please try again.');
                console.error('Set password error:', error);
            } finally {
                showLoading(false);
            }
        });

        // Allow only numbers in OTP field
        document.getElementById('otp').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
        });

        // Copy Institution Code
        document.getElementById('copyCodeBtn').addEventListener('click', function() {
            const code = document.getElementById('displayInstitutionCode').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                this.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Copied!
                `;
                this.classList.add('copied');
                
                showSuccess('Institution code copied to clipboard!');
                
                setTimeout(() => {
                    this.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    `;
                    this.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                showError('Failed to copy. Please write it down manually.');
                console.error('Copy failed:', err);
            });
        });
    </script>
</body>
</html>